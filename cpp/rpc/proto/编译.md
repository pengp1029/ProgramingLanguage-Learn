# 编译说明
## protoc
只编译消息类型使用 `protoc --cpp_out=./src proto/*.proto` 

## protoc-gen-grpc
要生成gRPC服务的代码需要使用gRPC的插件
1. 下载插件
```bash
brew install grpc
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```
2. 编译gRPC服务
```bash
protoc --cpp_out=./src --grpc_out=./src --plugin=protoc-gen-grpc=`which grpc_cpp_plugin` proto/*.proto
```
3. include路径添加
```json
{
    "configurations": [
        {
            "name": "Mac",
            "includePath": [
                "${workspaceFolder}/**",
                "${workspaceFolder}/cpp/rpc/src/proto/*",
                "/opt/homebrew/opt/protobuf/include",
                "/opt/homebrew/opt/grpc/include",
            ],
            "defines": [],
            "cStandard": "c17",
            "cppStandard": "c++17",
            "intelliSenseMode": "macos-clang-arm64"
        }
    ],
    "version": 4
}
```
4. 如何使用
```cpp
#include<grpcpp/grpcpp.h> // grpc所在库，基本用到grpc就得包含这个头文件
#include "proto/helloservice.grpc.pb.h"
using namespace rpc::proto::helloservice;
```

## cli安装
```bash
brew install cli11
find /opt/homebrew/Cellar/cli11 -name "*.hpp"
#/opt/homebrew/Cellar/cli11/2.6.1/include
# 编译时需要指定头文件路径
g++ -I/opt/homebrew/Cellar/cli11/2.6.1/include your_program.cpp -o your_program
```

## 代码编译
```bash
g++ -std=c++17 \      
    $(pkg-config --cflags grpc++ protobuf) \
    -I/opt/homebrew/Cellar/cli11/2.6.1/include/ \
    -I./src \
    -o hello_server \
    src/hello_server.cpp \
    src/proto/helloservice.grpc.pb.cc \
    src/proto/helloservice.pb.cc \
    $(pkg-config --libs grpc++ protobuf)
```
## 可能会出现的问题
### E1209 10:36:40.877861 124932191 add_port.cc:83] Failed to add port to server: No address added out of total 1 resolved for '127.0.0.1:50001'
可能是端口冲突，查看端口使用情况
### RPC failed: 14: failed to connect to all addresses; last error: UNKNOWN: ipv4:127.0.0.1:50001: connection attempt timed out before receiving SETTINGS frame
服务端监听0.0.0.0:50001，可能是端口冲突，查看端口使用情况